config:
  output_dir: examples/sample_output/
  memory_limit: 4GB
  # log_level: DEBUG
  # show_stacktrace: True
  # show_graph: True

sources:
  school_directory_no_grades:
    file: examples/sample_data/fake_school_directory_no_grades.csv
    # specifying more than 1 header row (and no columns) will use the last header row as column names:
    header_rows: 1
    # if file has no header row, or you want to overwrite column names, list them here:
  school_directory_grades_only:
    file: examples/sample_data/fake_school_directory_grades_only.csv
    # specifying more than 1 header row (and no columns) will use the last header row as column names:
    header_rows: 1
    # if file has no header row, or you want to overwrite column names, list them here:
    expect:
      - "low_grade != ''"
      - "high_grade != ''"
  state_abbr:
    file: examples/sample_data/state_abbr.tsv
    header_rows: 1

transformations:
  school_directory:
    # join two big (25k row) files
    - operation: join
      sources:
        - $sources.school_directory_no_grades
        - $sources.school_directory_grades_only
      join_type: inner
      left_key: cdscode
      right_key: cdscode
    
    # replace physical_address_state with a state abbreviation via join
    - operation: join
      sources:
        - $transformations.school_directory
        - $sources.state_abbr
      join_type: inner
      left_key: physical_address_state
      right_key: state
    - operation: drop_columns
      source: $transformations.school_directory
      columns:
        #- state
        - physical_address_state
    - operation: rename_columns
      source: $transformations.school_directory
      columns:
        abbr: physical_address_state

    # replace mailing_address_state with a state abbreviation via join
    - operation: join
      sources:
        - $transformations.school_directory
        - $sources.state_abbr
      join_type: inner
      left_key: mailing_address_state
      right_key: state
    - operation: drop_columns
      source: $transformations.school_directory
      columns:
        #- state
        - mailing_address_state
    - operation: rename_columns
      source: $transformations.school_directory
      columns:
        abbr: mailing_address_state
    
    - operation: rename_columns
      source: $transformations.school_directory
      columns:
        cdscode: school_id

destinations:
  schools:
    source: $transformations.school_directory
    template: examples/sample_templates/school.jsont
    extension: jsonl
    linearize: True